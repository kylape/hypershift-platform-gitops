---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pyroscope-config
  namespace: shared-services
  labels:
    app.kubernetes.io/name: pyroscope
    app.kubernetes.io/part-of: shared-services
data:
  config.yaml: |
    # Pyroscope Server Configuration
    # https://grafana.com/docs/pyroscope/latest/configure-server/reference-configuration-parameters/

    # Self-profiling for debugging Pyroscope itself
    self_profiling:
      disable_push: false

    # Analytics (disable in air-gapped environments)
    analytics:
      reporting_enabled: false

    # Server configuration
    server:
      http_listen_port: 4040
      log_level: info

    # Storage configuration - local filesystem for single binary mode
    # Migrate to S3/MinIO for microservices mode
    storage:
      backend: filesystem
      filesystem:
        dir: /data

    # Limits configuration
    limits:
      # Max profile size (10MB)
      max_label_names_per_series: 30
      max_label_value_length: 2048

    # Compactor settings
    compactor:
      blocks_retention_period: 168h  # 7 days

    # Query settings
    querier:
      max_query_length: 24h
